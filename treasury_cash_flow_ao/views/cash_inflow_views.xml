<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Ação para Entradas de Caixa Direta -->
        <record id="action_cash_in_entries" model="ir.actions.act_window">
            <field name="name">Entradas de Caixa Direta</field>
            <field name="res_model">account.payment</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[("is_direct_cash","=",True), ("payment_type","=","inbound")]</field>
            <field name="context">
                {
                'default_is_direct_cash': True,
                'default_cash_type': 'receita',
                'default_payment_type': 'inbound'
                }
            </field>
        </record>

        <!-- Submenu Receita dentro de Contas a Receber -->
        <menuitem id="menu_cash_income_group"
                  name="Receita"
                  parent="account.menu_finance_receivables"
                  sequence="10" />

        <!-- Item Entradas de Caixa Direta dentro de Receita -->
        <menuitem id="menu_cash_in_entries"
                  name="Entradas de Caixa Direta"
                  parent="menu_cash_income_group"
                  action="action_cash_in_entries"
                  sequence="20" />


        <!-- Ação para Saídas de Caixa Direta -->
        <record id="action_cash_out_entries" model="ir.actions.act_window">
            <field name="name">Saídas de Caixa Direta</field>
            <field name="res_model">account.payment</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[("is_direct_cash","=",True), ("payment_type","=","outbound")]</field>
            <field name="context">
                {
                'default_is_direct_cash': True,
                'default_cash_type': 'despesa',
                'default_payment_type': 'outbound'
                }
            </field>
        </record>

        <!-- Submenu Despesas dentro de Contas a Pagar -->
        <menuitem id="menu_cash_expense_group"
                  name="Despesas"
                  parent="account.menu_finance_payables"
                  sequence="10" />

        <!-- Item Saídas de Caixa Direta dentro de Despesas -->
        <menuitem id="menu_cash_out_entries"
                  name="Saídas de Caixa Direta"
                  parent="menu_cash_expense_group"
                  action="action_cash_out_entries"
                  sequence="20" />


        <!-- Tree View -->
        <record id="view_account_payment_tree_cash_direct" model="ir.ui.view">
            <field name="name">account.payment.tree.cash.direct</field>
            <field name="model">account.payment</field>
            <field name="inherit_id" ref="account.view_account_payment_tree" />
            <field name="mode">extension</field>
            <field name="arch" type="xml">
                <xpath expr="//tree" position="attributes">
                    <attribute name="decoration-danger">state == 'draft'</attribute>
                </xpath>
                <xpath expr="//tree" position="inside">
                    <field name="is_direct_cash" invisible="0"/>
                    <field name="cash_type"/>
                    <field name="product_template_id" attrs="{'invisible':[('is_direct_cash','=',True)]}"/>
                </xpath>
            </field>
        </record>

        <!-- Form View -->
        <record id="view_account_payment_form_cash_direct" model="ir.ui.view">
            <field name="name">account.payment.form.cash.direct</field>
            <field name="model">account.payment</field>
            <field name="inherit_id" ref="account.view_account_payment_form" />
            <field name="arch" type="xml">

                <xpath expr="//field[@name='partner_id']" position="replace">
                    <field name="partner_id" attrs="{'invisible': [('is_direct_cash', '=', True)]}" required="0"/>
                </xpath>

                <xpath expr="//field[@name='partner_bank_id']" position="before">
                    <field name="cash_partner_name"
                           attrs="{'invisible': [('is_direct_cash', '!=', True)]}"
                           placeholder="Ex: João, Técnico do Armazém"/>
                </xpath>

                <xpath expr="//form/sheet/group" position="before">
                    <field name="is_direct_cash" invisible="1"/>
                </xpath>

                <xpath expr="//form/sheet/group" position="after">
                    <group attrs="{'invisible': [('is_direct_cash','!=',True)]}">
                        <field name="cash_type" required="0" invisible="1"/>
                    </group>
                </xpath>

                <xpath expr="//field[@name='partner_bank_id']" position="after">
                    <field name="product_template_id"
                           string="Produto Associado"
                           domain="[('sale_ok', '=', True),
                                    '|',
                                    ('type', '=', 'service'),
                                    ('categ_id.name', 'ilike', cash_type == 'receita' and 'Receita' or 'Despesa')]"
                    attrs="{'invisible':[('is_direct_cash','!=',True)]}"/>
                    <field name="account_id" string="Conta Contábil" readonly="1" attrs="{'invisible':[('is_direct_cash','!=',True)]}"/>
                </xpath>

            </field>
        </record>

    </data>
</odoo>
